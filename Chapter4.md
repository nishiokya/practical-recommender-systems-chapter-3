# 4章　推薦アルゴリズムの概要



### 推薦システムの目的 
膨大な候補から価値あるものを選び、ユーザーの意思決定を支援する。これは主にユーザーの好みやアイテムの内容等の情報を利用し、どのアイテムがユーザーにとって好ましいかを計算します。

### 推薦アルゴリズムの種類
機械学習を利用した高度なものから、経験に基づく人手のルールベースまで多岐に渡る。適切なアルゴリズムを選ぶためには、それぞれの特性を理解し、状況に応じて選ぶ必要があります。

### 本章の目的
典型的な推薦システムのアルゴリズムの種類や特性、どのようにユーザーが好むアイテムを選び出すか、どのような場面で利用されるか等について、直感的に理解することを目指します。

#### 今後の進行
具体的なアルゴリズムの実装等の詳細については、次章で解説します。


## 4.1　推薦アルゴリズムの分類

#### 内容ベースフィルタリングの理解
キーメッセージ: 内容ベースフィルタリングはアイテムの内容を利用して推薦を行う
タリングは、アイテムの内容情報（タイトル、作者、ジャンルなど）を用いて、ユーザーが好む内容に近いアイテムを計算し推薦します。これにより、ユーザーの好みに適合したアイテムを提案できます。
### 協調フィルタリングの基本
協調フィルタリングは他のユーザーの好みの傾向を利用して推薦を行う
協調フィルタリングは、他のユーザーの過去の行動や好みの傾向を利用して推薦します。好みが似ているユーザー同士で共有されるアイテムを推薦することで、ユーザーに適切なアイテムを提案できます。


#### 協調フィルタリングの予測実行方法
協調フィルタリングはメモリベース法とモデルベース法に分類される
協調フィルタリングは、メモリベース法とモデルベース法に分類されます。メモリベース法では推薦時に蓄積されたデータ全てを使用し、予測計算を行います。一方、モデルベース法では事前にデータの規則性を学習したモデルを作成し、予測時にモデルと対象ユーザーのデータを利用して計算を行います。



| アイテム  | 作者      | ジャンル | 出版社 |
| --------- | --------- | -------- | ------ |
| アイテムA | 鈴木一郎  | ミステリー | A社    |
| アイテムB | 田中二郎  | ファンタジー | B社    |
| アイテムC | 山田三郎  | SF       | C社    |



#### ユーザープロファイル

| ユーザー  | 作者      | ジャンル | 出版社 |
| --------- | --------- | -------- | ------ |
| ユーザー1 | 鈴木一郎  | ミステリー | A社    |

#### アイテム特徴

| アイテム  | 作者      | ジャンル | 出版社 |
| --------- | --------- | -------- | ------ |
| アイテムA | 鈴木一郎  | ミステリー | A社    |
| アイテムB | 田中二郎  | ファンタジー | B社    |
| アイテムC | 山田三郎  | SF       | C社    |

#### 類似度評価

| ユーザー  | アイテム  | 類似度 |
| --------- | --------- | ------ |
| ユーザー1 | アイテムA | 高     |
| ユーザー1 | アイテムB | 低     |
| ユーザー1 | アイテムC | 低     |

## 4.2　内容ベースフィルタリング
### 4.2.1　概要
#### 内容ベースフィルタリングの概要
キーメッセージ: 内容ベースフィルタリングはユーザープロファイルとアイテム特徴の一致度で推薦を行う
内容ベースフィルタリングは、ユーザーが好む内容のアイテムを表すユーザープロファイルと、アイテムの特徴を表すアイテム特徴の類似度を計算し、その一致度に基づいてユーザーに推薦を行うアルゴリズムです。

#### ユーザープロファイルとアイテム特徴
キーメッセージ: ユーザープロファイルとアイテム特徴は推薦のための基礎データ
ユーザープロファイルは、ユーザーが好むアイテムの特徴をリスト化したもので、アイテム特徴はアイテムの属性情報などの特徴をリスト化したものです。これらは、推薦を行う際の基礎となるデータです。

#### 類似度に基づく推薦
キーメッセージ: ユーザープロファイルとアイテム特徴の類似度が高いアイテムを推薦
ユーザープロファイルとアイテム特徴の類似度が高いアイテムを推薦します。具体的には、ユーザープロファイルの特徴とアイテム特徴が多く一致するアイテムを選択します。この類似度の高さに基づいてアイテムを推薦するのが、内容ベースフィルタリングの基本的なアルゴリズムです。


### 4.2.2　アイテム特徴の獲得
#### アイテム特徴の獲得はアイテムの性質により異なり、それらは推薦アルゴリズムの一部となる
内容ベースフィルタリングでは、アイテムの特性を把握し、それをアイテム特徴として用いることが重要です。アイテム特徴の獲得方法は、アイテムの性質によります。

書籍の場合: タイトル、ジャンル、文字数、作者、出版日など、さまざまな属性情報を取得できます。

音楽の場合: 作曲者、作曲年などの属性情報を取得します。さらに、属性情報が無い場合でも、音声解析によって音の高さ、音色、音量などを取得可能です。

画像データの場合: 写真ならば写っている物体、撮影された場所、時間などの属性情報に加え、画像解析により色彩情報や被写体の形の特徴などを追加で取得できます。

これらの情報は、ユーザーがどのようなアイテムを好むかを理解し、推薦するアイテムを決定するための基礎となります。



### 4.2.3　ユーザープロファイルの獲得


#### ユーザープロファイルはユーザーの好みを表し、間接指定型と直接指定型の2つの方法で獲得可能である。
ユーザープロファイルは、ユーザーが好むアイテムの特徴を表すものであり、その獲得方法には主に2つあります。

|獲得方法|説明|
|---|---|
|間接指定型|こちらはユーザーの過去の行動履歴に基づいてユーザープロファイルを作成します。例えば、ユーザーの購入履歴から最も多く出現するアイテムの特徴を、そのユーザーが好むものとしてユーザープロファイルを作成する方法です。図4-7の例では、ユーザーが過去に購入した4つのアイテムから、「作者:田中太郎、ジャンル:SF、出版社:B社」が最も頻繁に出現するため、これをユーザープロファイルとしています。|
|直接指定型|この方法では、ユーザー自身が好きなアイテムの特徴を明示的に指定します。図4-8の例では、ユーザーが「作者:鈴木一郎、ジャンル:ミステリー、出版社:A社」を好むと自ら指定し、その情報がそのままユーザープロファイルとして獲得されています。ユーザー登録直後のオンボーディングや、マイページなどから好みを指定することが一般的です。|

これらのユーザープロファイルは、内容ベースフィルタリングの推薦アルゴリズムで使用され、ユーザーに最適なアイテムを推薦するための重要な要素となります。


*間接指定型のユーザープロファイル獲得*
以下は、ユーザーの過去の行動履歴（購入履歴）に基づいてユーザープロファイルを作成する間接指定型の例です。

| 購入アイテム | 作者 | ジャンル | 出版社 |
|---|---|---|---|
| アイテム1 | 田中太郎 | SF | B社 |
| アイテム2 | 田中太郎 | ミステリー | B社 |
| アイテム3 | 鈴木一郎 | SF | B社 |
| アイテム4 | 田中太郎 | SF | A社 |

この購入履歴から、「作者：田中太郎、ジャンル：SF、出版社：B社」が最も頻繁に出現するため、これをユーザープロファイルとします。

*直接指定型のユーザープロファイル獲得*
以下は、ユーザーが自分の好みを明示的に指定する直接指定型の例です。

```
ユーザーが好きな作者: 鈴木一郎
ユーザーが好きなジャンル: ミステリー
ユーザーが好きな出版社: A社
```
ユーザーが自ら指定した「作者:鈴木一郎、ジャンル:ミステリー、出版社:A社」がそのままユーザープロファイルとして獲得されます。

## 4.3　協調フィルタリング

協調フィルタリングは推薦アルゴリズムの一つで、メモリベース法とモデルベース法の2種類があります。メモリベース法はユーザー間型とアイテム間型に分かれ、ユーザー間型では好みが似ているユーザーに着目して推薦を行います。アイテム間型では、ユーザーが好むアイテムと似ているアイテムを推薦します。モデルベース法では、ユーザーとアイテムの関係を学習するモデルを作成し、推薦を行います。


### 4.3.1　メモリベース法のアルゴリズム概要
### 4.3.2　嗜好データの獲得と評価値行列
### 4.3.3　モデルベース法のアルゴリズム概要
### 4.3.4　メモリベース法とモデルベース法の協調フィルタリングの比較
## 4.4　内容ベースフィルタリングと協調フィルタリングの比較
### 4.4.1　多様性の向上
### 4.4.2　ドメイン知識を扱うコスト
### 4.4.3　コールドスタート問題への対応
### 4.4.4　ユーザー数が少ないサービスにおける推薦
### 4.4.5　被覆率の向上
### 4.4.6　アイテム特徴の活用
### 4.4.7　予測精度
### 4.4.8　比較のまとめ
## 4.5　推薦アルゴリズムの選択
【キーメッセージ】

適切な推薦アルゴリズム選択はサービスで達成したい目的に応じて決定
データ量に応じてアルゴリズムを選択
ハイブリッドな手法や複数のアルゴリズムを使い分けることが一般的

本節では、推薦アルゴリズムの選択方法について紹介します。推薦システムには、内容ベースフィルタリングと協調フィルタリングがありますが、どちらを選択するかはサービスで達成したい目的に応じて決定します。ただし、両方のアルゴリズムをハイブリッドに組み合わせることも一般的であり、ユーザーやアイテムの状況に応じて複数のアルゴリズムを使い分けることが必要です。

サービス内のデータ量に応じてアルゴリズムを選択することが一般的です。例えば、新規サービスや新規ユーザー、新規アイテムに対しては、データが少ないため内容ベースフィルタリングが適しています。一方、データが蓄積されたサービスでは、協調フィルタリングがより高い精度でアイテムを推薦できることが多いため、アルゴリズムを切り替えることが一般的です。

推薦システムの提供形態に応じたアルゴリズムの選択について説明します。一般的には、概要推薦では内容ベースフィルタリングが、関連アイテム推薦では協調フィルタリングが適しています。パーソナライズサービスでは、ユーザー間型メモリベース法の協調フィルタリングや間接指定型の内容ベースフィルタリングがよく用いられ、十分なデータが蓄積されている場合は、モデルベース法の協調フィルタリングが有効です。

また、推薦アイテムの多様性についても考慮することが重要です。具体的には、ユーザーが具体的なアイテムを探している場合、例えば特定のボールペン、は直接指定型の内容ベースフィルタリングが適しています。一方、具体的なアイテムが明確でない場合、例えばお菓子を探している場合、は多様性を提供できる協調フィルタリングが有用です



## 4.6　嗜好データの特徴
本節では、推薦システム設計に必要なユーザーの嗜好データについて説明します。推薦システムの正確な働きのためには、その入力データとしての嗜好データを適切に取得できるようサービスが設計される必要があります。その為には、嗜好データの特性を理解することが不可欠です。


### 4.6.1　明示的獲得と暗黙的獲得の比較


#### データ量

このセクションでは、嗜好データの2つの取得方法、つまり「明示的取得」と「暗黙的取得」を比較します。これらは異なる特性を持ち、推薦システムの目的に応じて選択されるべきです。
まず、「データ量」の観点から考えると、推薦の計算では統計的手法が多用され、正確な予測のためには大量のデータが重要です。この点において、一般的に暗黙的取得は明示的取得よりも多くの嗜好データを得ることができます。暗黙的取得では、ユーザーがサービスを利用している間、その行動から継続的に嗜好データを得ることが可能です。

一方、明示的取得では、ユーザーが積極的にアンケートやレビューに答えることで嗜好データを得るため、データの量は限られます。また、ユーザーは商品の購入や映画視聴などの主な目的のためにサービスを利用しており、余計な手間を強いるとユーザー体験を悪化させ、サービスから離脱するリスクがあります。明示的な取得を行う場合は、ユーザーに質問に答えるインセンティブを設計するなど、嗜好データを集めるための工夫が必要となります。


#### データの正確さ

「データの正確さ」観点から明示的獲得と暗黙的獲得を比較します。明示的獲得はユーザーが自分の好みを直接伝えるため、誤った嗜好データが得られる確率は低いです。しかし、暗黙的獲得では、ユーザーの行動から直接好みを推測するため、正確な嗜好データを得るのが難しい場合があります。操作ミスや関心のない内容への一時的なアクセスなど、ユーザーの真の意図を正確に理解することが困難です。

そのため、暗黙的獲得を行う際には、例えば、ユーザーが特定のページに一定時間滞在した場合のみ、そのアイテムに対する関心があるとみなすなど、条件を設定する工夫が必要です。しかし、このような条件設定は、関心があるにもかかわらずそのデータが得られない可能性も生じます。したがって、正確な嗜好データを得るためには、サービスやデータの特性を考慮し、適切なユーザー行動を定義する必要があります。さらに、これらのユーザー行動を識別できるように、ログを事前にサービスに組み込むことも必要となります。

#### 未評価と不支持の区別
「未評価と不支持の区別」の観点から明示的獲得と暗黙的獲得を比較します。未評価は、ユーザーから特定のアイテムに対する嗜好データがない状態を指し、不支持はユーザーがアイテムに対してネガティブな嗜好データを持っている状態を指します。

明示的獲得では、ユーザーがアイテムに対するアンケートやレビューに応答していない場合を未評価、反対に否定的な回答をした場合を不支持と明確に区別することが可能です。

しかし、暗黙的獲得では未評価と不支持の区別は一般的に困難であり、不明確です。推薦された映画を視聴しなかった場合、その理由がユーザーの好みでないから、それとも視聴する気分ではなかったり忙しかったりするからかの区別がつきません。全てを不支持と判断すると、本当は好きだけど視聴していない映画を嫌いと判定し、推薦の精度を落とす可能性があります。

この問題を解決するためには、例えば「3回推薦されても視聴しなかった場合には不支持とみなす」といった条件を設定することが必要です。サービスやデータの特性を考慮した設計を行い、適切な嗜好データを獲得することが求められます。

#### ユーザーの認知


### 4.6.2　嗜好データを扱う際の注意点
## 4.7　まとめ